<html>
<head>
  <title>FileDB API</title>
  <style>
h2 {
    margin-top: 30px;
}
pre {
    background-color: lightgray;
    margin-left: 10px;
    padding: 10px;
    border: 1px solid black;
    border-radius: 5px;
}
  </style>
</head>
<body>

<h1>FileDB API</h1>
<p>The FileDB webapp uses this API. This documentation is mostly of interest for developers who wants to use data stored by FileDB in other applications.</p>

<h2>Authentication</h2>
<pre>Request: POST /api/login?username=username&password=password
Response: 200 (OK), 401 (Unauthorized), cookie (session=...)
</pre>

<pre>Request: POST /api/logout
Response: 200 (OK)
</pre>

<h2>Fetch Data: file info</h2>
<pre>Request: GET /api/file/&lt;id&gt;
Response: 200 (OK), 404 (Not Found), 401 (Unauthorized)
{
    "id": id,
    "path": path,
    "description": description,
    "datetime": datetime,
    "persons": [1, 2, ...],
    "locations": [1, 2, ...],
    "tags": [1, 2, ...]
}
</pre>

<pre>Request: GET /api/files/[?personids=personids][&locationids=locationids][&tagids=tagids][&pathregexp=pathregexp][&descriptionregexp=descriptionregexp][&datetimeregexp=datetimeregexp]
Response: 200 (OK), 401 (Unauthorized)
{
    "files" =
    [
        Same data here as for single file
    ]
}
</pre>

<h2>Fetch Data: file content</h2>
<pre>
Request: GET /api/filecontent/&lt;id&gt;
Response: 200 (OK), 401 (Unauthorized), 404 (Not Found), data with content-type depending on file extension
</pre>

<h2>Fetch Data: Exif (from JPEG images)</h2>
<pre>
Request: GET /api/fileexif/&lt;file_id&gt;
Response: 200 (OK), 401 (Unauthorized), 404 (Not Found)
</pre>

<h2>Fetch Data: thumbnail</h2>
<p>Generates and returns a small version of the specified image file. Note that the image is generated for each request. The image aspect ratio is kept.</p>
<pre>
Request: GET /api/thumbnail/&lt;id&gt;?[width=width][&height=height]
Response: 200 (OK), 401 (Unauthorized), 404 (Not Found), data with content-type depending on file extension
</pre>

<h2>Fetch Data: directories</h2>
<p>Returns a list of directories available from imported/added files or directories on the filesystem within the configured root directory.</p>
<pre>Request: GET /api/directories
Request: GET /api/fs_directories
Response: 200 (OK), 401 (Unauthorized)
{
    "directories" =
    [
        "first_dir",
        "second_dir",
        ...
    ]
}
</pre>

<h2>Fetch Data: persons</h2>
<pre>Request: GET /api/person/&lt;id&gt;
Response: 200 (OK), 401 (Unauthorized), 404 (Not Found)
{
    "id": id,
    "name": name,
    "description": description,
    "dateofbirth": dateofbirth
}
</pre>

<pre>Request: GET /api/persons
Request: GET /api/persons?orderby=&lt;column&gt;
Response: 200 (OK), 401 (Unathorized)
{
    "persons" =
    [
        Same data here as for single person
    ]
}
</pre>

<h2>Fetch Data: locations</h2>
<pre>Request: GET /api/location/&lt;id&gt;
Response: 200 (OK), 404 (Not Found), 401 (Unathorized)
{
    "id": id,
    "name": name,
    "description": description
}
</pre>

<pre>
Request: GET /api/locations
Request: GET /api/locations?orderby=&lt;column&gt;
Response: 200 (OK), 401 (Unathorized)
{
    "locations" =
    [
        Same data here as for single location
    ]
}
</pre>

<h2>Fetch Data: tags</h2>
<pre>Request: GET /tag/&lt;id&gt;
Response: 200 (OK), 404 (Not Found), 401 (Unathorized)
{
    "id": id,
    "name": name
}
</pre>

<pre>
Request: GET /api/tags
Request: GET /api/tags?orderby=&lt;column&gt;
Response: 200 (OK), 401 (Unathorized)
{
    "tags" =
    [
        Same data here as for single tag
    ]
}
</pre>

<h2>Add Data</h2>
<pre>Request: POST /api/import
Request: POST /api/file/?path=path&description=description
Request: POST /api/directory/?path=path
Response: 200 (OK), 409 (Conflict), 401 (Unathorized)
</pre>

<pre>Request: POST /api/person/?name=name
Response:
{
    Same data here as for a single person
}
</pre>

<pre>Request: POST /api/location/?name=name
Response:
{
    Same data here as for a single location
}
</pre>

<pre>Request: POST /api/tag/?name=name
Response:
{
    Same data here as for a single tag
}
</pre>

<h2>Modify Data</h2>
<pre>
Request: PUT /api/file/&lt;id&gt;
Response: 201 (OK), ...
{
    Same data here as for a single file
}
</pre>

<pre>Request: PUT /api/person/&lt;id&gt;
Response: 201 (OK), ...
{
    Same data here as for single person
}
</pre>

<pre>Request: PUT /api/location/&lt;id&gt;
Response: 201 (OK), ...
{
    Same data here as for single location
}
</pre>

<pre>Request: PUT /api/tag/&lt;id&gt;
Response: 201 (OK), ...
{
    Same data here as for single tag
}
</pre>

<h2>Remove Data</h2>
<p>Note that when removing a person, location or tag, this meta-data is removed from the files it was used in.</p>
<pre>
Request: DELETE /api/file/&lt;id&gt;
Request: DELETE /api/person/&lt;id&gt;
Request: DELETE /api/location/&lt;id&gt;
Request: DELETE /api/tag/&lt;id&gt;
Response: 200 (OK), 404 (Not Found), 401 (Unathorized)
</pre>

<h2>Check File Consistency</h2>
<p>Checks that all imported/added files is available. Returns the list of missing files.</p>
<pre>Request: GET /api/fileconsistency
Response: 200 (OK), 401 (Unathorized)
{
    "missingfiles" = [fileid, fileid, ...]
}
</pre>

</body>
</html>
